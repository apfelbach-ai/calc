<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kopfrechnen Trainer</title>
</head>
<body>
    <h1>Kopfrechnen Trainer</h1>
    <p id="aufgabe">Lade Aufgabe...</p>
    <input type="number" id="antwortInput" placeholder="Deine Antwort" autofocus>
    <button id="checkButton">Prüfen</button>
    <p id="ergebnis"></p>

    <script>
        // JavaScript-Logik für die Kopfrechen-App

        // Elemente von der HTML-Seite holen
        const aufgabeElement = document.getElementById('aufgabe');
        const antwortInput = document.getElementById('antwortInput');
        const checkButton = document.getElementById('checkButton');
        const ergebnisElement = document.getElementById('ergebnis');

        let currentProblemId; // Speichert die ID der aktuellen Aufgabe

        // WICHTIG: Diese URL musst du später mit der URL deiner AWS API Gateway-Instanz ersetzen!
        // Zum Beispiel: 'https://dein-api-gateway-id.execute-api.eu-central-1.amazonaws.com/prod'
        const API_BASE_URL = 'DEINE_API_GATEWAY_URL_HIER'; // Placeholder

        /**
         * Holt eine neue Kopfrechenaufgabe vom Backend (deinem Python-Code auf AWS Lambda).
         */
        async function getNewProblem() {
            try {
                // Sende eine Anfrage an dein Backend, um eine neue Aufgabe zu bekommen
                const response = await fetch(`${API_BASE_URL}/problem`);

                // Prüfe, ob die Anfrage erfolgreich war (Status 200 OK)
                if (!response.ok) {
                    throw new Error(`Netzwerkantwort war nicht OK: ${response.statusText}`);
                }

                // Die Antwort vom Backend ist JSON und enthält die Aufgabe und ihre ID
                const data = await response.json();

                // Zeige die Aufgabe auf der Webseite an
                aufgabeElement.textContent = data.problem;
                currentProblemId = data.problem_id; // Speichere die Problem-ID für die Überprüfung

                // Zurücksetzen der Anzeige und des Eingabefelds
                ergebnisElement.textContent = ''; // Alte Ergebnis-Nachricht löschen
                antwortInput.value = ''; // Eingabefeld leeren
                antwortInput.focus(); // Setze den Cursor ins Eingabefeld
            } catch (error) {
                console.error('Fehler beim Laden der Aufgabe:', error);
                aufgabeElement.textContent = 'Fehler beim Laden der Aufgabe. Bitte versuche es später noch einmal.';
            }
        }

        /**
         * Sendet die Antwort des Benutzers an das Backend zur Überprüfung.
         */
        async function checkAnswer() {
            const userAnswer = parseInt(antwortInput.value); // Holt die Antwort aus dem Eingabefeld und wandelt sie in eine Zahl um

            // Wenn keine gültige Zahl eingegeben wurde, zeige eine Nachricht an und brich ab
            if (isNaN(userAnswer)) {
                ergebnisElement.textContent = 'Bitte gib eine gültige Zahl ein.';
                // Optional: Füge hier eine Klasse hinzu, um die Farbe zu ändern (braucht CSS)
                return; // Beende die Funktion hier
            }

            try {
                // Sende die Problem-ID und die Benutzerantwort an dein Backend
                const response = await fetch(`${API_BASE_URL}/check`, {
                    method: 'POST', // Wir senden Daten, also ist es eine POST-Anfrage
                    headers: {
                        'Content-Type': 'application/json', // Sagen dem Server, dass wir JSON senden
                    },
                    // Wandle die Daten (Problem-ID und Antwort) in JSON um
                    body: JSON.stringify({
                        problem_id: currentProblemId,
                        answer: userAnswer
                    })
                });

                // Prüfe, ob die Anfrage erfolgreich war
                if (!response.ok) {
                    // Wenn der Status 400 ist (Bad Request), könnte es eine spezifische Fehlermeldung vom Backend geben
                    if (response.status === 400) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Ungültige Anfrage.');
                    }
                    throw new Error(`Netzwerkantwort war nicht OK: ${response.statusText}`);
                }

                // Verarbeite die Antwort vom Backend
                const data = await response.json();

                // Zeige an, ob die Antwort richtig oder falsch war
                if (data.is_correct) {
                    ergebnisElement.textContent = 'Richtig!';
                    // Optional: ergebnisElement.className = 'richtig'; (braucht CSS)
                } else {
                    ergebnisElement.textContent = `Falsch! Die richtige Antwort war ${data.correct_answer}.`;
                    // Optional: ergebnisElement.className = 'falsch'; (braucht CSS)
                }

                // Nach 2 Sekunden eine neue Aufgabe laden
                setTimeout(getNewProblem, 2000);
            } catch (error) {
                console.error('Fehler beim Überprüfen der Antwort:', error);
                ergebnisElement.